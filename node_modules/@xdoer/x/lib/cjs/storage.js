"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Store = void 0;

var _object = require("./object");

function generate(target, fn) {
  return new Proxy(target, {
    apply: (_, __, args) => fn(target, args)
  });
}

const Store = ctx => {
  const storageNames = ['localStorage', 'sessionStorage'];
  storageNames.forEach(storageName => {
    const target = ctx[storageName] || {};
    target.setItem = generate(globalThis[storageName].setItem, (target, args) => {
      const [key, value] = args;
      return Reflect.apply(target, globalThis[storageName], [key, JSON.stringify((0, _object.typeTree)(value))]);
    });
    target.getItem = generate(globalThis[storageName].getItem, (target, args) => {
      const result = Reflect.apply(target, globalThis[storageName], args);
      return (0, _object.resolveTypeTree)(JSON.parse(result));
    });
    target.removeItem = generate(globalThis[storageName].removeItem, (target, args) => {
      return Reflect.apply(target, globalThis[storageName], args);
    });
    target.clear = generate(globalThis[storageName].clear, (target, args) => {
      return Reflect.apply(target, globalThis[storageName], args);
    });
    ctx[storageName] = target;
  });
  return ctx;
};

exports.Store = Store;