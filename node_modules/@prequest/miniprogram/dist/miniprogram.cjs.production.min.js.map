{"version":3,"file":"miniprogram.cjs.production.min.js","sources":["../src/adapter.ts","../src/create.ts"],"sourcesContent":["import { createError, createRequestUrl, ErrorCode } from '@prequest/helper'\nimport { Config, PQRequest, PQResponse } from '@prequest/types'\nimport { RequestCore } from './types'\n\nexport function adapter(request: RequestCore) {\n  return (opt: Config): Promise<PQResponse> => {\n    return new Promise((resolve, reject) => {\n      const finalOption = (opt || {}) as PQRequest\n      const url = createRequestUrl(finalOption)\n      const { getNativeRequestInstance, cancelToken, ...rest } = finalOption\n\n      const instance = request({\n        url,\n        ...rest,\n        success: resolve,\n        fail: reject,\n      })\n\n      if (cancelToken) {\n        cancelToken.promise.then(cancel => {\n          if (!instance) return\n\n          // 如果支持取消方法\n          if (instance.abort) return instance.abort()\n\n          // 如果不支持，则直接抛出错误\n          reject(createError(ErrorCode.abort, cancel, opt))\n        })\n      }\n\n      getNativeRequestInstance?.(instance)\n    })\n  }\n}\n","import { PreQuest } from '@prequest/core'\nimport { RequestCore } from './types'\nimport { adapter } from './adapter'\nimport { Adapter, Config } from '@prequest/types'\n\nexport function create(core: RequestCore, options?: Config, wrapper = (v: Adapter) => v) {\n  return PreQuest.create(wrapper(adapter(core)), options)\n}\n"],"names":["adapter","request","opt","Promise","resolve","reject","finalOption","url","createRequestUrl","getNativeRequestInstance","cancelToken","rest","instance","success","fail","promise","then","cancel","abort","createError","ErrorCode","core","options","wrapper","v","PreQuest","create"],"mappings":"2IAIgBA,EAAQC,UACdC,GACC,IAAIC,QAAQ,CAACC,EAASC,WACrBC,EAAeJ,GAAO,GACtBK,EAAMC,mBAAiBF,IACvBG,yBAAEA,EAAFC,YAA4BA,KAAgBC,GAASL,EAErDM,EAAWX,EAAQ,CACvBM,IAAAA,KACGI,EACHE,QAAST,EACTU,KAAMT,IAGJK,GACFA,EAAYK,QAAQC,KAAKC,OAClBL,SAGDA,EAASM,MAAcN,EAASM,aAGpCb,EAAOc,cAAYC,YAAUF,MAAOD,EAAQf,MAIhDO,MAAAA,GAAAA,EAA2BG,2ICzBVS,EAAmBC,EAAkBC,mBAAAA,IAAAA,EAAWC,GAAeA,GAC7EC,WAASC,OAAOH,EAAQvB,EAAQqB,IAAQC"}