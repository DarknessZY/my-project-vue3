{"version":3,"file":"miniprogram.cjs.development.js","sources":["../src/adapter.ts","../src/create.ts"],"sourcesContent":["import { createError, createRequestUrl, ErrorCode } from '@prequest/helper'\nimport { Config, PQRequest, PQResponse } from '@prequest/types'\nimport { RequestCore } from './types'\n\nexport function adapter(request: RequestCore) {\n  return (opt: Config): Promise<PQResponse> => {\n    return new Promise((resolve, reject) => {\n      const finalOption = (opt || {}) as PQRequest\n      const url = createRequestUrl(finalOption)\n      const { getNativeRequestInstance, cancelToken, ...rest } = finalOption\n\n      const instance = request({\n        url,\n        ...rest,\n        success: resolve,\n        fail: reject,\n      })\n\n      if (cancelToken) {\n        cancelToken.promise.then(cancel => {\n          if (!instance) return\n\n          // 如果支持取消方法\n          if (instance.abort) return instance.abort()\n\n          // 如果不支持，则直接抛出错误\n          reject(createError(ErrorCode.abort, cancel, opt))\n        })\n      }\n\n      getNativeRequestInstance?.(instance)\n    })\n  }\n}\n","import { PreQuest } from '@prequest/core'\nimport { RequestCore } from './types'\nimport { adapter } from './adapter'\nimport { Adapter, Config } from '@prequest/types'\n\nexport function create(core: RequestCore, options?: Config, wrapper = (v: Adapter) => v) {\n  return PreQuest.create(wrapper(adapter(core)), options)\n}\n"],"names":["adapter","request","opt","Promise","resolve","reject","finalOption","url","createRequestUrl","getNativeRequestInstance","cancelToken","rest","instance","success","fail","promise","then","cancel","abort","createError","ErrorCode","create","core","options","wrapper","v","PreQuest"],"mappings":";;;;;;;SAIgBA,QAAQC;AACtB,SAAQC,GAAD;AACL,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV;AACjB,YAAMC,WAAW,GAAIJ,GAAG,IAAI,EAA5B;AACA,YAAMK,GAAG,GAAGC,uBAAgB,CAACF,WAAD,CAA5B;AACA,YAAM;AAAEG,QAAAA,wBAAF;AAA4BC,QAAAA,WAA5B;AAAyC,WAAGC;AAA5C,UAAqDL,WAA3D;AAEA,YAAMM,QAAQ,GAAGX,OAAO,CAAC;AACvBM,QAAAA,GADuB;AAEvB,WAAGI,IAFoB;AAGvBE,QAAAA,OAAO,EAAET,OAHc;AAIvBU,QAAAA,IAAI,EAAET;AAJiB,OAAD,CAAxB;;AAOA,UAAIK,WAAJ,EAAiB;AACfA,QAAAA,WAAW,CAACK,OAAZ,CAAoBC,IAApB,CAAyBC,MAAM;AAC7B,cAAI,CAACL,QAAL,EAAe;;AAGf,cAAIA,QAAQ,CAACM,KAAb,EAAoB,OAAON,QAAQ,CAACM,KAAT,EAAP;;AAGpBb,UAAAA,MAAM,CAACc,kBAAW,CAACC,gBAAS,CAACF,KAAX,EAAkBD,MAAlB,EAA0Bf,GAA1B,CAAZ,CAAN;AACD,SARD;AASD;;AAEDO,MAAAA,wBAAwB,SAAxB,IAAAA,wBAAwB,WAAxB,YAAAA,wBAAwB,CAAGG,QAAH,CAAxB;AACD,KAzBM,CAAP;AA0BD,GA3BD;AA4BD;;SC5BeS,OAAOC,QAAmBC,SAAkBC;MAAAA;AAAAA,IAAAA,UAAWC,CAAD,IAAgBA;;;AACpF,SAAOC,aAAQ,CAACL,MAAT,CAAgBG,OAAO,CAACxB,OAAO,CAACsB,MAAD,CAAR,CAAvB,EAAwCC,OAAxC,CAAP;AACD;;;;;;;;;;;"}