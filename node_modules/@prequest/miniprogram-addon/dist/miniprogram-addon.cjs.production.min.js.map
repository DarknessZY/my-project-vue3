{"version":3,"file":"miniprogram-addon.cjs.production.min.js","sources":["../src/adapter.ts","../src/create.ts"],"sourcesContent":["import { createError, createRequestUrl, ErrorCode } from '@prequest/helper'\nimport { PQRequest } from '@prequest/types'\nimport { RequestCore } from './types'\n\nexport function adapter<T, N>(request: RequestCore) {\n  return (opt: T): Promise<N> => {\n    return new Promise((resolve, reject) => {\n      const finalOption = (opt || {}) as PQRequest\n      const url = createRequestUrl(finalOption)\n      const { getNativeRequestInstance, cancelToken, ...rest } = finalOption\n\n      const instance = request({\n        ...rest,\n        url,\n        success: resolve,\n        fail: reject,\n      })\n\n      if (cancelToken) {\n        cancelToken.promise.then(cancel => {\n          if (!instance) return\n\n          // 如果支持取消方法\n          if (instance.abort) return instance.abort()\n\n          // 如果不支持，则直接抛出错误\n          reject(createError(ErrorCode.abort, cancel, opt as any))\n        })\n      }\n\n      getNativeRequestInstance?.(instance)\n    })\n  }\n}\n","import { PreQuest } from '@prequest/core'\nimport { RequestCore, UploadResponse, DownLoadResponse } from './types'\nimport { adapter } from './adapter'\nimport { Config } from '@prequest/types'\n\nexport function createUpload(request: RequestCore, options?: Config) {\n  return PreQuest.create(adapter<Config, UploadResponse>(request), options)\n}\n\nexport function createDownload(request: RequestCore, options?: Config) {\n  return PreQuest.create(adapter<Config, DownLoadResponse>(request), options)\n}\n"],"names":["adapter","request","opt","Promise","resolve","reject","finalOption","url","createRequestUrl","getNativeRequestInstance","cancelToken","rest","instance","success","fail","promise","then","cancel","abort","createError","ErrorCode","options","PreQuest","create"],"mappings":"2IAIgBA,EAAcC,UACpBC,GACC,IAAIC,QAAQ,CAACC,EAASC,WACrBC,EAAeJ,GAAO,GACtBK,EAAMC,mBAAiBF,IACvBG,yBAAEA,EAAFC,YAA4BA,KAAgBC,GAASL,EAErDM,EAAWX,EAAQ,IACpBU,EACHJ,IAAAA,EACAM,QAAST,EACTU,KAAMT,IAGJK,GACFA,EAAYK,QAAQC,KAAKC,OAClBL,SAGDA,EAASM,MAAcN,EAASM,aAGpCb,EAAOc,cAAYC,YAAUF,MAAOD,EAAQf,MAIhDO,MAAAA,GAAAA,EAA2BG,mJCrBFX,EAAsBoB,UAC5CC,WAASC,OAAOvB,EAAkCC,GAAUoB,kCALxCpB,EAAsBoB,UAC1CC,WAASC,OAAOvB,EAAgCC,GAAUoB"}