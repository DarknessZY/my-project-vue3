{"version":3,"file":"miniprogram-addon.cjs.development.js","sources":["../src/adapter.ts","../src/create.ts"],"sourcesContent":["import { createError, createRequestUrl, ErrorCode } from '@prequest/helper'\nimport { PQRequest } from '@prequest/types'\nimport { RequestCore } from './types'\n\nexport function adapter<T, N>(request: RequestCore) {\n  return (opt: T): Promise<N> => {\n    return new Promise((resolve, reject) => {\n      const finalOption = (opt || {}) as PQRequest\n      const url = createRequestUrl(finalOption)\n      const { getNativeRequestInstance, cancelToken, ...rest } = finalOption\n\n      const instance = request({\n        ...rest,\n        url,\n        success: resolve,\n        fail: reject,\n      })\n\n      if (cancelToken) {\n        cancelToken.promise.then(cancel => {\n          if (!instance) return\n\n          // 如果支持取消方法\n          if (instance.abort) return instance.abort()\n\n          // 如果不支持，则直接抛出错误\n          reject(createError(ErrorCode.abort, cancel, opt as any))\n        })\n      }\n\n      getNativeRequestInstance?.(instance)\n    })\n  }\n}\n","import { PreQuest } from '@prequest/core'\nimport { RequestCore, UploadResponse, DownLoadResponse } from './types'\nimport { adapter } from './adapter'\nimport { Config } from '@prequest/types'\n\nexport function createUpload(request: RequestCore, options?: Config) {\n  return PreQuest.create(adapter<Config, UploadResponse>(request), options)\n}\n\nexport function createDownload(request: RequestCore, options?: Config) {\n  return PreQuest.create(adapter<Config, DownLoadResponse>(request), options)\n}\n"],"names":["adapter","request","opt","Promise","resolve","reject","finalOption","url","createRequestUrl","getNativeRequestInstance","cancelToken","rest","instance","success","fail","promise","then","cancel","abort","createError","ErrorCode","createUpload","options","PreQuest","create","createDownload"],"mappings":";;;;;;;SAIgBA,QAAcC;AAC5B,SAAQC,GAAD;AACL,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV;AACjB,YAAMC,WAAW,GAAIJ,GAAG,IAAI,EAA5B;AACA,YAAMK,GAAG,GAAGC,uBAAgB,CAACF,WAAD,CAA5B;AACA,YAAM;AAAEG,QAAAA,wBAAF;AAA4BC,QAAAA,WAA5B;AAAyC,WAAGC;AAA5C,UAAqDL,WAA3D;AAEA,YAAMM,QAAQ,GAAGX,OAAO,CAAC,EACvB,GAAGU,IADoB;AAEvBJ,QAAAA,GAFuB;AAGvBM,QAAAA,OAAO,EAAET,OAHc;AAIvBU,QAAAA,IAAI,EAAET;AAJiB,OAAD,CAAxB;;AAOA,UAAIK,WAAJ,EAAiB;AACfA,QAAAA,WAAW,CAACK,OAAZ,CAAoBC,IAApB,CAAyBC,MAAM;AAC7B,cAAI,CAACL,QAAL,EAAe;;AAGf,cAAIA,QAAQ,CAACM,KAAb,EAAoB,OAAON,QAAQ,CAACM,KAAT,EAAP;;AAGpBb,UAAAA,MAAM,CAACc,kBAAW,CAACC,gBAAS,CAACF,KAAX,EAAkBD,MAAlB,EAA0Bf,GAA1B,CAAZ,CAAN;AACD,SARD;AASD;;AAEDO,MAAAA,wBAAwB,SAAxB,IAAAA,wBAAwB,WAAxB,YAAAA,wBAAwB,CAAGG,QAAH,CAAxB;AACD,KAzBM,CAAP;AA0BD,GA3BD;AA4BD;;SC5BeS,aAAapB,SAAsBqB;AACjD,SAAOC,aAAQ,CAACC,MAAT,CAAgBxB,OAAO,CAAyBC,OAAzB,CAAvB,EAA0DqB,OAA1D,CAAP;AACD;AAED,SAAgBG,eAAexB,SAAsBqB;AACnD,SAAOC,aAAQ,CAACC,MAAT,CAAgBxB,OAAO,CAA2BC,OAA3B,CAAvB,EAA4DqB,OAA5D,CAAP;AACD;;;;;;;;;;;;"}